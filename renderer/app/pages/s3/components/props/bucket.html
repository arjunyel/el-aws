<h3 class="drawer-header">

  <div class="icon">

    <fa-icon
      [icon]="desc.icon.split(' ')"
      [ngStyle]="{color: desc.color}"
      *ngIf="desc.icon"
      size="lg">
    </fa-icon>

  </div>

  <div class="title">
    {{ desc.name | libBreakable }}
  </div>

</h3>

<form
  (submit)="close()"
  [formGroup]="propsForm"
  [libRxfSubmit]="propsForm"
  *ngIf="propsForm"
  novalidate>

  <input
    formControlName="path"
    type="hidden">

  <mat-accordion>

    <!-- ACCELERATE -->

    <mat-expansion-panel
      formGroupName="accelerate">

      <mat-expansion-panel-header>
        <mat-panel-title>
          Acceleration    
          <div class="drawer-label">
            {{ metadata?.acceleration?.Status || 'Off' }}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <mat-radio-group
        class="group"
        formControlName="Status">

        <div class="drawer-label">
          Use endpoint <a>{{ desc.name }}.s3-accelerate.amazonaws.com</a> for faster data transfers, which will incur an additional fee.
        </div>

        <mat-radio-button value="Enabled">
          Enable acceleration
        </mat-radio-button>
        <mat-radio-button value="Suspended">
          Suspend acceleration
        </mat-radio-button>

      </mat-radio-group>

    </mat-expansion-panel>

    <!-- ENCRYPTION -->

    <mat-expansion-panel
      formGroupName="encryption">

      <mat-expansion-panel-header>
        <mat-panel-title>
          Encryption
          <div class="drawer-label">
            {{ metadata?.encryption?.ServerSideEncryptionConfiguration?.Rules[0]?.ApplyServerSideEncryptionByDefault?.SSEAlgorithm || 'None' }}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div formGroupName="ServerSideEncryptionConfiguration">
        <div formArrayName="Rules">
          <div [formGroupName]="0">
            <div 
              class="group"
              formGroupName="ApplyServerSideEncryptionByDefault">

              <mat-radio-group
                class="group"
                formControlName="SSEAlgorithm">

                <div class="drawer-label">
                  This property does not affect existing objects in your bucket.
                </div>

                <mat-radio-button value="None">
                  None
                </mat-radio-button>
                <mat-radio-button #AES256 value="AES256">
                  AES-256
                  <div class="drawer-label">
                    Use Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3).
                  </div>
                </mat-radio-button>
                <mat-radio-button #AWSKMS value="aws:kms">
                  AWS-KMS
                  <div class="drawer-label">
                    Use Server-Side Encryption with AWS KMS-Managed Keys (SSE-KMS).
                  </div>
                </mat-radio-button>

              </mat-radio-group>

              <!-- NOTE: can't use *ngIf because of form validation -->

              <mat-form-field
                [ngStyle]="{display: AWSKMS.checked? 'block' : 'none'}">
                <input
                  [required]="AWSKMS.checked"
                  formControlName="KMSMasterKeyID"
                  placeholder="Select a key"
                  matInput
                  type="text">
              </mat-form-field>

              <div
                *ngIf="AES256.checked || AWSKMS.checked" 
                class="drawer-label">
                Amazon S3 evaluates and applies bucket policies before applying bucket encryption settings. Even if you enable bucket encryption settings, your PUT requests without encryption information will be rejected if you have bucket policies to reject such PUT requests. Check your bucket policy and modify it if required.
              </div>

            </div>
          </div>
        </div>
      </div>

    </mat-expansion-panel>

    <!-- TAGGING -->

    <mat-expansion-panel
      formGroupName="tagging">

      <mat-expansion-panel-header>
        <mat-panel-title>
          Tags
          <div class="drawer-label">
            {{ metadata?.tagging?.TagSet?.length? (metadata.tagging.TagSet.length | i18nPlural: tagLabelMapping) : 'None' }}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="group">

        <div class="drawer-label">
          Use tags to track your cost against projects or other criteria.
        </div>

        <elaws-key-value
          [asArrayOfHashes]="['Key', 'Value']"
          duplicateKeyMessage="Tag name is already in use"
          formControlName="TagSet"
          placeholder="New tag name">

          <ng-template #keyIcon>
            <fa-icon
              [icon]="['fas', 'key']"
              flip="horizontal"
              size="xs"
              style="color: var(--primary-color)">
            </fa-icon>
            &nbsp;
          </ng-template>

          <ng-template #valueIcon>
            <fa-icon
              [icon]="['fas', 'tag']"
              size="xs"
              style="color: var(--primary-color)">
            </fa-icon>
            &nbsp;
          </ng-template>

        </elaws-key-value>

      </div>

    </mat-expansion-panel>

    <!-- VERSIONING -->

    <mat-expansion-panel
      formGroupName="versioning">

      <mat-expansion-panel-header>
        <mat-panel-title>
          Versioning
          <div class="drawer-label">
            {{ metadata?.versioning?.Status || 'Off' }}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <mat-radio-group
        class="group"
        formControlName="Status">

        <mat-radio-button value="Enabled">
          Enable versioning
        </mat-radio-button>
        <mat-radio-button value="Suspended">
          Suspend versioning
          <div class="drawer-label">
            This suspends the creation of object versions for all operations but preserves any existing object versions.
          </div>
        </mat-radio-button>

      </mat-radio-group>

    </mat-expansion-panel>

  </mat-accordion>

  <div class="okAndCancel">

    <a
      (click)="close()"
      mat-button>
      Cancel
    </a>

    <button
      [disabled]="propsForm.invalid || !metadata"
      color="primary"
      mat-raised-button
      type="submit">
      OK
    </button>

  </div>

</form>
